var mat4={scalar:{},SIMD:{}};mat4.create=function(){var a=new Float32Array(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},mat4.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},mat4.rotate=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},mat4.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a};var O={};O.SHADERS={vert:"    attribute vec3 aVertexPosition;    attribute vec2 aTextureCoord;    uniform mat4 uMVMatrix;    uniform mat4 uPMatrix;    varying vec2 vTextureCoord;    void main(void) {        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);        vTextureCoord = aTextureCoord;    }",frag:"    precision mediump float;    varying vec2 vTextureCoord;    uniform sampler2D uSampler;    void main(void) {        gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));    }"},O.Canvas=function(a,b){function c(){var a;try{return a=f.el.getContext("webgl")||f.el.getContext("experimental-webgl")}catch(b){console.error("problem initializing webgl.")}return null}function d(){f.gl.viewportWidth=f.el.width,f.gl.viewportHeight=f.el.height,f.gl.clearColor(1,1,1,1),f.gl.enable(f.gl.DEPTH_TEST),f.gl.depthFunc(f.gl.LEQUAL)}function e(){return f.gl=c(),f.gl.x=Math.random(),f.gl?(d(),void(f.children=[])):void console.error("Unable to initialize WebGL. Your browser may not support it.")}var f=this;"string"==typeof a?(f.el=document.getElementById(a),f.w=f.el.width,f.h=f.el.height):(f.el=document.createElement("canvas"),f.w=a,f.h=b,f.el.width=a,f.el.height=b),f.addChild=function(a){a.setParent(f),f.children.push(a)},f.addChildAtIndex=function(a,b){f.children.splice(b,0,a)},f.removeChild=function(a){var b;for(b=0;b<f.children.length;b+=1)f.children[b]==a&&f.children.splice(b,1)},f.render=function(){var a;for(f.gl.viewport(0,0,f.gl.viewportWidth,f.gl.viewportHeight),f.gl.clear(f.gl.COLOR_BUFFER_BIT|f.gl.DEPTH_BUFFER_BIT),a=0;a<f.children.length;a+=1)f.children[a].render()},e()},O.Sprite=function(a){function b(){e(),g(),c()}function c(){m.tex=l.createTexture(),m.tex.image=new Image,m.tex.image.onload=function(){f(m.tex)},m.tex.image.src=a.src}function d(a,b){var c;return"frag"==a?c=l.createShader(l.FRAGMENT_SHADER):"vert"==a&&(c=l.createShader(l.VERTEX_SHADER)),l.shaderSource(c,b),l.compileShader(c),l.getShaderParameter(c,l.COMPILE_STATUS)?c:(alert(l.getShaderInfoLog(c)),null)}function e(){var a=d("frag",O.SHADERS.frag),b=d("vert",O.SHADERS.vert);k=l.createProgram(),l.attachShader(k,b),l.attachShader(k,a),l.linkProgram(k),l.getProgramParameter(k,l.LINK_STATUS)||(console.error("Could not initialise shaders"),console.error(l.getProgramInfoLog(k))),l.useProgram(k),k.vertexPositionAttribute=l.getAttribLocation(k,"aVertexPosition"),l.enableVertexAttribArray(k.vertexPositionAttribute),k.textureCoordAttribute=l.getAttribLocation(k,"aTextureCoord"),l.enableVertexAttribArray(k.textureCoordAttribute),k.pMatrixUniform=l.getUniformLocation(k,"uPMatrix"),k.mvMatrixUniform=l.getUniformLocation(k,"uMVMatrix")}function f(a){l.bindTexture(l.TEXTURE_2D,a),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,a.image),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.bindTexture(l.TEXTURE_2D,null)}function g(){var b,c,d,e=a.width/m.parent.w,f=a.height/m.parent.h;h=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,h),b=[e,f,0,-e,f,0,e,-f,0,-e,-f,0],l.bufferData(l.ARRAY_BUFFER,new Float32Array(b),l.STATIC_DRAW),h.itemSize=3,h.numItems=4,i=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,i),c=[1,0,0,0,1,1,0,1],l.bufferData(l.ARRAY_BUFFER,new Float32Array(c),l.STATIC_DRAW),i.itemSize=2,i.numItems=6,j=l.createBuffer(),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,j),d=[0,1,2,0,2,3],l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),l.STATIC_DRAW),j.itemSize=1,j.numItems=6}var h,h,i,j,k,l,m=this,n=mat4.create(),o=mat4.create();this.ox=0,this.oy=0,this.x=0,this.y=0,this._sx=1,this._sy=1,this.r=0,Object.defineProperties(m,{s:{get:function(){return m._sx},set:function(a){m._sx=a,m._sy=a}},sx:{get:function(){return m._sx},set:function(a){m._sx=a}},sy:{get:function(){return m._sy},set:function(a){m._sy=a}}}),m.setParent=function(a){m.parent=a,l=m.parent.gl,console.log(l.x),b()},m.render=function(){l&&(mat4.perspective(45,l.viewportWidth/l.viewportHeight,.1,100,o),mat4.identity(n),mat4.translate(n,n,[m.x/l.viewportWidth,m.y/l.viewportHeight,0]),mat4.translate(n,n,[m.ox/l.viewportWidth,m.oy/l.viewportHeight,0]),mat4.rotate(n,n,m.r*Math.PI/180),mat4.scale(n,n,[m._sx,m._sy,1]),mat4.translate(n,n,[-m.x/l.viewportWidth,-m.y/l.viewportHeight,0]),mat4.translate(n,n,[-m.ox/l.viewportWidth,-m.oy/l.viewportHeight,0]),mat4.translate(n,n,[m.x/l.viewportWidth,m.y/l.viewportHeight,0]),l.useProgram(k),l.bindBuffer(l.ARRAY_BUFFER,h),l.vertexAttribPointer(k.vertexPositionAttribute,h.itemSize,l.FLOAT,!1,0,0),l.bindBuffer(l.ARRAY_BUFFER,i),l.vertexAttribPointer(k.textureCoordAttribute,i.itemSize,l.FLOAT,!1,0,0),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,m.tex),l.uniform1i(k.samplerUniform,0),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,j),l.uniformMatrix4fv(k.pMatrixUniform,!1,o),l.uniformMatrix4fv(k.mvMatrixUniform,!1,n),l.drawArrays(l.TRIANGLE_STRIP,0,h.numItems))}};